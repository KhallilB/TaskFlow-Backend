{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/npm",
      "args": ["install"]
    },
    {
      "name": "gcr.io/cloud-builders/npm",
      "args": ["run", "create-env"],
      "env": [
        "MONGO_URI=${_MONGO_URI}",
        "JWT_SECRET=${_JWT_SECRET}",
        "JWT_EXPIRE=${_JWT_EXPIRE}"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/npm",
      "args": ["run", "build"]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": ["build", "-t", "gcr.io/task-flow-backend/task-flow-backend-image", "."]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": ["push", "gcr.io/task-flow-backend/task-flow-backend-image"]
    },
    {
      "name": "gcr.io/cloud-builders/gcloud",
      "args": ["app", "deploy", "app.yaml", "--image-url", "gcr.io/task-flow-backend/task-flow-backend-image"]
    }
  ],
  "images": ["gcr.io/$PROJECT_ID/your-image-name"],
  "timeout": "1200s"
}
